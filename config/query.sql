CREATE TABLE TB_USUARIO (
    ID_USUARIO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, 
    NOME VARCHAR2(100) NOT NULL,
    EMAIL VARCHAR2(100) UNIQUE NOT NULL,
    SENHA_HASH VARCHAR2(255) NOT NULL -- RN 7.1: Tamanho maior para BCrypt
);

-- 2.2. TB_CONTA (O Saldo/Dinheiro - RN 1.0)
CREATE TABLE TB_CONTA (
    ID_CONTA NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_USUARIO NUMBER NOT NULL,
    MOEDA VARCHAR2(3) DEFAULT 'BRL', 
    SALDO_INICIAL NUMBER(12, 2) DEFAULT 0,
    CONSTRAINT FK_CONTA_USER FOREIGN KEY (ID_USUARIO) 
        REFERENCES TB_USUARIO(ID_USUARIO)
);

-- 2.3. TB_CATEGORIA (Classificação - RN 2.3)
CREATE TABLE TB_CATEGORIA (
    ID_CATEGORIA NUMBER PRIMARY KEY, -- Não auto-incrementável para facilitar dados fixos
    NOME VARCHAR2(50) UNIQUE NOT NULL
);

-- 2.4. TB_TRANSACAO (Movimentação Financeira - RN 2.0)
CREATE TABLE TB_TRANSACAO (
    ID_TRANSACAO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_CONTA NUMBER NOT NULL,
    ID_CATEGORIA NUMBER,
    TIPO VARCHAR2(25) CHECK (TIPO IN ('RECEITA', 'DESPESA', 'INVESTIMENTO_COMPRA')) NOT NULL, -- RN 2.2
    VALOR NUMBER(12, 2) NOT NULL,
    DESCRICAO VARCHAR2(255),
    DATA_TRANSACAO DATE DEFAULT SYSDATE,
    
    CONSTRAINT FK_TRANSACAO_CONTA FOREIGN KEY (ID_CONTA) 
        REFERENCES TB_CONTA(ID_CONTA),
    CONSTRAINT FK_TRANSACAO_CAT FOREIGN KEY (ID_CATEGORIA) 
        REFERENCES TB_CATEGORIA(ID_CATEGORIA)
);

-- 2.5. TB_INVESTIMENTO (Ativos Comprados - RN 1.2)
CREATE TABLE TB_INVESTIMENTO (
    ID_INVESTIMENTO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_CONTA NUMBER NOT NULL,
    NOME_ATIVO VARCHAR2(100) NOT NULL, -- Ex: Bitcoin, Ação XPTO
    QUANTIDADE NUMBER(12, 5) NOT NULL,
    VALOR_UNITARIO_COMPRA NUMBER(12, 2),
    DATA_COMPRA DATE DEFAULT SYSDATE,
    CONSTRAINT FK_INVEST_CONTA FOREIGN KEY (ID_CONTA) 
        REFERENCES TB_CONTA(ID_CONTA)
);


-- =============================================
-- 3. INSERÇÃO DE DADOS DE TESTE (DML)
-- =============================================

-- 3.1. Usuário de Teste (ID_USUARIO = 1) e Conta (ID_CONTA = 1)
-- IMPORTANTE: A senha '123456' é salva aqui para teste, mas o sistema usará BCrypt (RN 7.1)
INSERT INTO TB_USUARIO (ID_USUARIO, NOME, EMAIL, SENHA_HASH) VALUES (1, 'Sabrina Teste', 'teste@aurum.com', '123456'); 
INSERT INTO TB_CONTA (ID_USUARIO, SALDO_INICIAL) VALUES (1, 5000.00); 

-- 3.2. Categorias Fixas
INSERT INTO TB_CATEGORIA (ID_CATEGORIA, NOME) VALUES (100, 'Salário');
INSERT INTO TB_CATEGORIA (ID_CATEGORIA, NOME) VALUES (200, 'Moradia');
INSERT INTO TB_CATEGORIA (ID_CATEGORIA, NOME) VALUES (300, 'Alimentação');
INSERT INTO TB_CATEGORIA (ID_CATEGORIA, NOME) VALUES (400, 'Investimento');

-- 3.3. Transações de Teste (Para calcular o saldo)
-- Saldo Inicial = 5000.00

-- + 3500.00 (Receita)
INSERT INTO TB_TRANSACAO (ID_CONTA, ID_CATEGORIA, TIPO, VALOR, DESCRICAO) 
VALUES (1, 100, 'RECEITA', 3500.00, 'Depósito de Salário'); 

-- - 1500.00 (Despesa)
INSERT INTO TB_TRANSACAO (ID_CONTA, ID_CATEGORIA, TIPO, VALOR, DESCRICAO) 
VALUES (1, 200, 'DESPESA', 1500.00, 'Aluguel'); 

-- - 500.00 (Investimento/Retirada de liquidez)
INSERT INTO TB_TRANSACAO (ID_CONTA, ID_CATEGORIA, TIPO, VALOR, DESCRICAO) 
VALUES (1, 400, 'INVESTIMENTO_COMPRA', 500.00, 'Compra de BTC (Retirada)'); 

-- Saldo Esperado = 5000 + 3500 - 1500 - 500 = 6500.00

